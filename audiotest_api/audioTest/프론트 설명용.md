ì¢‹ì•„! ì°¨ê·¼ì°¨ê·¼ ì •ë¦¬í•´ì¤„ê²Œ.

## ğŸ“‹ streaming.html â†” ë°±ì—”ë“œ í†µì‹  í”„ë¡œí† ì½œ

### 1ï¸âƒ£ ì„¸ì…˜ ì‹œì‘: `/start`

**ìš”ì²­**
```
POST /start
- Body: ì—†ìŒ
```

**ì‘ë‹µ**
```json
{
  "sessionId": "uuid-ë¬¸ìì—´"
}
```

**ì˜ˆì‹œ**
```javascript
const startRes = await fetch('/start', { method: 'POST' });
const startData = await startRes.json();
// startData.sessionId = "550e8400-e29b-41d4-a716-446655440000"
```

---

### 2ï¸âƒ£ ì²­í¬ ì—…ë¡œë“œ: `/upload-chunk`

**ìš”ì²­**
```
POST /upload-chunk
Content-Type: multipart/form-data

íŒŒë¼ë¯¸í„°:
- sessionId (string): ì„¸ì…˜ ID
- seq (string): ì²­í¬ ìˆœì„œ ë²ˆí˜¸ (0ë¶€í„° ì‹œì‘)
- chunk (file): ì˜¤ë””ì˜¤ íŒŒì¼ (audio/webm)
- container (string): "webm" ê³ ì •
```

**ì‘ë‹µ**
```json
{
  "seq": 123,                    // ìˆ«ì: ì²­í¬ ë²ˆí˜¸
  "status": "Silent|Speech|Finished|Error",  // ìƒíƒœ
  "text": "ì¸ì‹ëœ í…ìŠ¤íŠ¸" or null,   // ìŒì„± ì¸ì‹ ê²°ê³¼
  "finalSent": true or false     // (ì„ íƒ) ìµœì¢… ì „ì†¡ ì—¬ë¶€
}
```

**ì˜ˆì‹œ**
```javascript
const formData = new FormData();
formData.append('sessionId', '550e8400-...');
formData.append('seq', '0');
formData.append('chunk', audioBlob, 'chunk-0.webm');
formData.append('container', 'webm');

const uploadRes = await fetch('/upload-chunk', { 
  method: 'POST', 
  body: formData 
});

const uploadData = await uploadRes.json();
// uploadData = {
//   "seq": 0,
//   "status": "Silent",
//   "text": null
// }
```

---

### 3ï¸âƒ£ Status ê°’ì˜ ì˜ë¯¸

| Status | ì˜ë¯¸ | UI í‘œì‹œ |
|--------|------|---------|
| `Silent` | ë¬´ìŒ ìƒíƒœ | ğŸŸ¡ ë…¸ë€ìƒ‰ |
| `Speech` | ìŒì„± ê°ì§€ ì¤‘ | ğŸŸ¢ ì´ˆë¡ìƒ‰ |
| `Finished` | ìŒì„± ì¸ì‹ ì™„ë£Œ | ğŸ”´ ë¹¨ê°„ìƒ‰ ê¹œë¹¡ì„ |
| `Error` | ì—ëŸ¬ ë°œìƒ | ğŸ”´ ë¹¨ê°„ìƒ‰ ê¹œë¹¡ì„ |

---

### 4ï¸âƒ£ ì „ì²´ í†µì‹  íë¦„

```
1. ì‚¬ìš©ìê°€ "ë…¹ìŒ ì‹œì‘" í´ë¦­
   â†“
2. POST /start â†’ sessionId ë°›ìŒ
   â†“
3. 0.5ì´ˆë§ˆë‹¤ ì˜¤ë””ì˜¤ ì²­í¬ ìƒì„±
   â†“
4. POST /upload-chunk (ì²­í¬ ì „ì†¡)
   â†“
5. ë°±ì—”ë“œ ì‘ë‹µ:
   - status: "Silent" (ë¬´ìŒ)
   - status: "Speech" (ìŒì„± ê°ì§€)
   - status: "Finished" + text (ì™„ë£Œ)
   â†“
6. Finished ë°›ìœ¼ë©´ â†’ 1ì´ˆ í›„ ìë™ ì¤‘ì§€ ë° ì´ˆê¸°í™”
```

---

### 5ï¸âƒ£ í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ í¬ì¸íŠ¸

```javascript
// 1. ì„¸ì…˜ ì‹œì‘
const { sessionId } = await fetch('/start', { method: 'POST' }).then(r => r.json());

// 2. 0.5ì´ˆë§ˆë‹¤ ì²­í¬ ì „ì†¡
setInterval(() => {
  mediaRecorder.requestData();  // ì²­í¬ ìƒì„± íŠ¸ë¦¬ê±°
}, 500);

// 3. ì²­í¬ ì „ì†¡ ë° ì‘ë‹µ ì²˜ë¦¬
mediaRecorder.ondataavailable = async (event) => {
  const formData = new FormData();
  formData.append('sessionId', sessionId);
  formData.append('seq', String(seq++));
  formData.append('chunk', event.data, `chunk-${seq}.webm`);
  formData.append('container', 'webm');
  
  const res = await fetch('/upload-chunk', { method: 'POST', body: formData });
  const data = await res.json();
  
  // 4. ìƒíƒœì— ë”°ë¥¸ UI ì—…ë°ì´íŠ¸
  if (data.status === 'Silent') {
    // ğŸŸ¡ ë…¸ë€ìƒ‰
  } else if (data.status === 'Speech') {
    // ğŸŸ¢ ì´ˆë¡ìƒ‰
  } else if (data.status === 'Finished') {
    // ğŸ”´ ë¹¨ê°„ìƒ‰ + í…ìŠ¤íŠ¸ í‘œì‹œ
    console.log('ì¸ì‹ëœ í…ìŠ¤íŠ¸:', data.text);
    // 1ì´ˆ í›„ ë…¹ìŒ ì¤‘ì§€
  }
};
```

---

### 6ï¸âƒ£ ìš”ì²­/ì‘ë‹µ ë°ì´í„° í¬ê¸°

**ìš”ì²­ (ì²­í¬ í•˜ë‚˜)**
- sessionId: ~36 bytes (UUID)
- seq: ~10 bytes
- chunk: **5,000~20,000 bytes** (0.5ì´ˆ ì˜¤ë””ì˜¤)
- container: 4 bytes
- **ì´: ì•½ 5~20 KB/ì²­í¬**

**ì‘ë‹µ**
- seq: 4 bytes
- status: 6~8 bytes
- text: ê°€ë³€ (0~ìˆ˜ë°± bytes)
- **ì´: ì•½ 100~500 bytes**

**ì „ì²´ í†µì‹ ëŸ‰ (10ì´ˆ ë…¹ìŒ)**
- ì—…ë¡œë“œ: 20ê°œ ì²­í¬ Ã— 10KB = **200KB**
- ë‹¤ìš´ë¡œë“œ: 20ê°œ ì‘ë‹µ Ã— 200B = **4KB**

---

ì´ê²Œ ì „ì²´ í†µì‹  í”„ë¡œí† ì½œì´ì•¼. ë°±ì—”ë“œ ë§Œë“¤ ë•Œ ì´ ìŠ¤í™ ê·¸ëŒ€ë¡œ ë§ì¶”ë©´ ë¼!